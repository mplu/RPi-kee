/****************************************************************/
/* Driver for IR Sensor GP2Y0A710K0F (100-550cm)                */
/* File : IR_100_550.c                                          */
/* Description :                                                */
/*   Function use to get data from FarIR Sensor                 */
/*                                                              */
/* Author : MPE                                                 */
/*                                                              */
/****************************************************************/
#include "../includes.h"

/****************************************************************/
/* GetDistancefromFarIR()                                       */
/* Description :                                                */
/*   Calculate distance value from voltage value                */
/*                                                              */
/* Input:                                                       */
/*   voltage - voltage in millivot                              */
/*                                                              */
/* Output:                                                      */
/*   none                                                       */
/* Return:                                                      */
/*   distance in cm                                             */
/*                                                              */
/****************************************************************/
CPU_INT16U GetDistancefromFarIR(CPU_INT16U voltage)
{
    CPU_INT32U distance;

    distance = voltage *3;


    return (CPU_INT16U)distance;
}



/********** PT100_Interpolation Table for voltage *******/
static float Interpolation_voltage[] = {
0.463,	0.47375,	0.4845,	0.4955,	0.50625,	0.517,	0.52775,	0.5385,	0.54925,	0.56,	0.57075,	0.58125,	0.592,	0.60275,	0.6135,	0.62425,	0.63475,	0.6455,	0.656,	0.66675,	0.6775,	0.688,	0.69875,	0.70925,	0.72,
0.7305,	0.741,	0.75175,	0.76225,	0.77275,	0.7835,	0.794,	0.8045,	0.815,	0.8255,	0.836,	0.8465,	0.857,	0.8675,	0.878,	0.8885,	0.899,	0.9095,	0.92,	0.9305,	0.941,	0.95125,	0.96175,	0.97225,	0.98275,
0.993,	1.0035,	1.014,	1.02425,	1.03475,	1.045,	1.0555,	1.06575,	1.07625,	1.0865,	1.097,	1.10725,	1.1175,	1.128,	1.13825,	1.1485,	1.159,	1.16925,	1.1795,	1.18975,	1.2,	1.2105,	1.22075,	1.231,	1.24125,
1.2515,	1.26175,	1.272,	1.28225,	1.2925,	1.30275,	1.313,	1.32325,	1.3335,	1.34375,	1.35375,	1.364,	1.37425,	1.3845,	1.39475,	1.40475,	1.415,	1.42525,	1.43525,	1.4455,	1.45575,	1.46575,	1.476,	1.486,	1.49625,
1.5065,	1.5165,	1.52675,	1.53675,	1.547,	1.557,	1.567,	1.57725,	1.58725,	1.5975,	1.6075,	1.6175,	1.62775,	1.63775,	1.64775,	1.65775,	1.668,	1.678,	1.688,	1.698,	1.70825,	1.71825,	1.72825,	1.73825,	1.74825,
1.75825,	1.76825,	1.77825,	1.78825,	1.79825,	1.80825,	1.81825,	1.82825,	1.83825,	1.84825,	1.85825,	1.86825,	1.87825,	1.88825,	1.89825,	1.90825,	1.91825,	1.928,	1.938,	1.948,	1.958,	1.968,	1.97775,	1.98775,	1.99775,
2.00775,	2.0175,	2.0275,	2.0375,	2.04725,	2.05725,	2.06725,	2.077,	2.087,	2.09675,	2.10675,	2.11675,	2.1265,	2.1365,	2.14625,	2.15625,	2.166,	2.176,	2.18575,	2.19575,	2.2055,	2.2155,	2.22525,	2.235,	2.245,
2.25475,	2.26475,	2.2745,	2.28425,	2.29425,	2.304,	2.31375,	2.32375,	2.3335,	2.34325,	2.353,	2.363,	2.37275,	2.3825,	2.39225,	2.40225,	2.412,	2.42175,	2.4315,	2.44125,	2.451,	2.461,	2.47075,	2.4805,	2.49025,
2.5,	2.50975,	2.5195,	2.52925,	2.539,	2.54875,	2.5585,	2.56825,	2.578,	2.58775,	2.5975,	2.60725,	2.617,	2.62675,	2.6365,	2.64625,	2.656,	2.66575,	2.6755,	2.685,	2.69475,	2.7045,	2.71425,	2.724,	2.73375,
2.74325,	2.753,	2.76275,	2.7725,	2.78225,	2.79175,	2.8015,	2.81125,	2.82075,	2.8305,	2.84025,	2.85,	2.8595,	2.86925,	2.87875,	2.8885,	2.89825,	2.90775,	2.9175,	2.927,	2.93675,	2.9465,	2.956,	2.96575,	2.97525,
2.985,	2.9945,	3.00425,	3.01375,	3.0235,	3.033,	3.04275,	3.05225,	3.06175,	3.0715,	3.081,	3.09075,	3.10025,	3.10975,	3.1195,	3.129,	3.1385,	3.14825,	3.15775,	3.16725,	3.177,	3.1865,	3.196,	3.2055,	3.21525,
3.22475,	3.23425,	3.24375,	3.25325,	3.263,	3.2725,	3.282,	3.2915,	3.301,	3.3105,	3.32,	3.3295,	3.33925,	3.34875,	3.35825,	3.36775,	3.37725,	3.38675,	3.39625,	3.40575,	3.41525,	3.42475,	3.43425,	3.44375,	3.45325,
3.46275,	3.472,	3.4815,	3.491,	3.5005,	3.51,	3.5195,	3.529,	3.5385,	3.54775,	3.55725,	3.56675,	3.57625,	3.58575,	3.595,	3.6045,	3.614,	3.6235,	3.63275,	3.64225,	3.65175,	3.661,	3.6705,	3.68,	3.68925,
3.69875,	3.70825,	3.7175,	3.727,	3.7365,	3.74575,	3.75525,	3.7645,	3.774,	3.78325,	3.79275,	3.802,	3.8115,	3.82075,	3.83025,	3.8395,	3.849,	3.85825,	3.86775,	3.877,	3.8865,	3.89575,	3.905,	3.9145,	3.92375,
3.93325,	3.9425,	3.95175,	3.96125,	3.9705,	3.97975,	3.989,	3.9985,	4.00775,	4.017,	4.02625,	4.03575,	4.045,	4.05425,	4.0635,	4.07275,	4.08225,	4.0915,	4.10075,	4.11,	4.11925,	4.1285,	4.13775,	4.14725,	4.1565,
4.16575,	4.175,	4.18425,	4.1935,	4.20275,	4.212,	4.22125,	4.2305,	4.23975,	4.249,	4.25825,	4.2675,	4.27675,	4.28575,	4.295,	4.30425,	4.3135,	4.32275,	4.332,	4.34125,	4.3505,	4.3595,	4.36875,	4.378,	4.38725,
4.3965,	4.4055,	4.41475,	4.424,	4.43325,	4.44225,	4.4515,	4.46075,	4.46975,	4.479,	4.48825,	4.49725,	4.5065,	4.51575,	4.52475,	4.534,	4.543,	4.55225,	4.5615,	4.5705,	4.57975,	4.58875,	4.598,	4.607,	4.61625,
4.62525,	4.6345,	4.6435,	4.65275,	4.66175,	4.671,	4.68,	4.689,	4.69825,	4.70725,	4.7165,	4.7255,	4.7345,	4.74375,	4.75275,	4.76175,	4.771,	4.78,	4.789,	4.798,	4.80725,	4.81625,	4.82525,	4.83425,	4.8435,
4.8525,	4.8615,	4.8705,	4.8795,	4.88875,	4.89775,	4.90675,	4.91575,	4.92475,	4.93375,	4.94275,	4.95175,	4.96075,	4.96975,	4.97875,	4.98775,	4.99675,	5.00575,	5.01475,	5.02375,	5.03275,	5.04175,	5.05075,	5.05975,	5.06875,
5.07775,	5.08675,	5.09575,	5.10475,	5.11375,	5.1225,	5.1315,	5.1405,	5.1495,	5.1585,	5.1675,	5.17625,	5.18525,	5.19425,	5.20325,	5.212,	5.221,	5.23,	5.239,	5.24775,	5.25675,	5.26575,	5.2745,	5.2835,	5.2925,
5.30125,	5.31025,	5.319,	5.328,	5.337,	5.34575,	5.35475,	5.3635,	5.3725,	5.38125,	5.39025,	5.399,	5.408,	5.41675,	5.42575,	5.4345,	5.4435,	5.45225,	5.461,	5.47,	5.47875,	5.48775,	5.4965,	5.50525,	5.51425,
5.523,	5.53175,	5.54075,	5.5495,	5.55825,
} ;

/****** PT100_Interpolation Table for temperature *******/
static float Interpolation_temperature[] = {
-200,	-199,	-198,	-197,	-196,	-195,	-194,	-193,	-192,	-191,	-190,	-189,	-188,	-187,	-186,	-185,	-184,	-183,	-182,	-181,	-180,	-179,	-178,	-177,	-176,
-175,	-174,	-173,	-172,	-171,	-170,	-169,	-168,	-167,	-166,	-165,	-164,	-163,	-162,	-161,	-160,	-159,	-158,	-157,	-156,	-155,	-154,	-153,	-152,	-151,
-150,	-149,	-148,	-147,	-146,	-145,	-144,	-143,	-142,	-141,	-140,	-139,	-138,	-137,	-136,	-135,	-134,	-133,	-132,	-131,	-130,	-129,	-128,	-127,	-126,
-125,	-124,	-123,	-122,	-121,	-120,	-119,	-118,	-117,	-116,	-115,	-114,	-113,	-112,	-111,	-110,	-109,	-108,	-107,	-106,	-105,	-104,	-103,	-102,	-101,
-100,	-99,	-98,	-97,	-96,	-95,	-94,	-93,	-92,	-91,	-90,	-89,	-88,	-87,	-86,	-85,	-84,	-83,	-82,	-81,	-80,	-79,	-78,	-77,	-76,
-75,	-74,	-73,	-72,	-71,	-70,	-69,	-68,	-67,	-66,	-65,	-64,	-63,	-62,	-61,	-60,	-59,	-58,	-57,	-56,	-55,	-54,	-53,	-52,	-51,
-50,	-49,	-48,	-47,	-46,	-45,	-44,	-43,	-42,	-41,	-40,	-39,	-38,	-37,	-36,	-35,	-34,	-33,	-32,	-31,	-30,	-29,	-28,	-27,	-26,
-25,	-24,	-23,	-22,	-21,	-20,	-19,	-18,	-17,	-16,	-15,	-14,	-13,	-12,	-11,	-10,	-9,	-8,	-7,	-6,	-5,	-4,	-3,	-2,	-1,
0,	1,	2,	3,	4,	5,	6,	7,	8,	9,	10,	11,	12,	13,	14,	15,	16,	17,	18,	19,	20,	21,	22,	23,	24,
25,	26,	27,	28,	29,	30,	31,	32,	33,	34,	35,	36,	37,	38,	39,	40,	41,	42,	43,	44,	45,	46,	47,	48,	49,
50,	51,	52,	53,	54,	55,	56,	57,	58,	59,	60,	61,	62,	63,	64,	65,	66,	67,	68,	69,	70,	71,	72,	73,	74,
75,	76,	77,	78,	79,	80,	81,	82,	83,	84,	85,	86,	87,	88,	89,	90,	91,	92,	93,	94,	95,	96,	97,	98,	99,
100,	101,	102,	103,	104,	105,	106,	107,	108,	109,	110,	111,	112,	113,	114,	115,	116,	117,	118,	119,	120,	121,	122,	123,	124,
125,	126,	127,	128,	129,	130,	131,	132,	133,	134,	135,	136,	137,	138,	139,	140,	141,	142,	143,	144,	145,	146,	147,	148,	149,
150,	151,	152,	153,	154,	155,	156,	157,	158,	159,	160,	161,	162,	163,	164,	165,	166,	167,	168,	169,	170,	171,	172,	173,	174,
175,	176,	177,	178,	179,	180,	181,	182,	183,	184,	185,	186,	187,	188,	189,	190,	191,	192,	193,	194,	195,	196,	197,	198,	199,
200,	201,	202,	203,	204,	205,	206,	207,	208,	209,	210,	211,	212,	213,	214,	215,	216,	217,	218,	219,	220,	221,	222,	223,	224,
225,	226,	227,	228,	229,	230,	231,	232,	233,	234,	235,	236,	237,	238,	239,	240,	241,	242,	243,	244,	245,	246,	247,	248,	249,
250,	251,	252,	253,	254,	255,	256,	257,	258,	259,	260,	261,	262,	263,	264,	265,	266,	267,	268,	269,	270,	271,	272,	273,	274,
275,	276,	277,	278,	279,	280,	281,	282,	283,	284,	285,	286,	287,	288,	289,	290,	291,	292,	293,	294,	295,	296,	297,	298,	299,
300,	301,	302,	303,	304,	305,	306,	307,	308,	309,	310,	311,	312,	313,	314,	315,	316,	317,	318,	319,	320,	321,	322,	323,	324,
325,	326,	327,	328,	329,

} ;

/****************************************************************************/
/*	 CPU_INT32S PT100_Check_for_Interpolation(float x)						*/
/*--------------------------------------------------------------------------*/
/*	DESCRIPTION : Determine if x stays in the temperature range				*/
/*							----------------								*/
/*	INPUT : 	x															*/
/*							----------------								*/
/*	OUTPUT:	  	0		success												*/
/*				400 	failure												*/
/****************************************************************************/
CPU_INT32S PT100_Check_for_Interpolation(float x)
{
	CPU_INT16S index_max = 530;
	CPU_INT32S ret;

	if (x < Interpolation_voltage[0])
	{
		ret = 1;
	}
	else if (x > Interpolation_voltage[index_max-1])
	{
		ret = 1;
	}
	else
	{
		ret = 0;
	}
	return ret;

}


/********************************************************************************************************/
/*	 void PT100_Interpolation_light(float x, float* X1, float* X2, float* Y1, float* Y2)				*/
/*------------------------------------------------------------------------------------------------------*/
/*	DESCRIPTION : Determine the parameters for calculating the temperature based on a voltage on PT100	*/
/*							----------------															*/
/*	INPUT : 	x																						*/
/*				*X1																						*/
/*				*X2																						*/
/*				*Y1																						*/
/*				*Y2																						*/
/*							----------------															*/
/*	OUTPUT:	  	none																					*/
/********************************************************************************************************/
void PT100_Interpolation_light(float x, float* X1, float* X2, float* Y1, float* Y2)
{
	CPU_INT16S index_max = 530;

	CPU_INT32S median = 0, start_ind = 0, end_ind = index_max - 1;

	{	// dichotomic research
		while(start_ind <= end_ind)
		{
		    median = (start_ind+end_ind)/2;
		    if((Interpolation_voltage[median] <= x) && (Interpolation_voltage[median+1] > x))
		    {
		    	start_ind = end_ind + 1;
		    }
		    else if(Interpolation_voltage[median] < x)
		    {
		    	start_ind = median+1;
		    }

		    else if(Interpolation_voltage[median] >= x)
		    {
		    	end_ind = median-1;
		    }

    	}

    	*Y1 = Interpolation_temperature[median];
		*Y2 = Interpolation_temperature[median+1];
		*X1 = Interpolation_voltage[median];
		*X2 = Interpolation_voltage[median+1];
	}
}

/************************************************************************************/
/*	 float calcul_interpolation(float x, float X1, float X2, float Y1, float Y2)	*/
/*----------------------------------------------------------------------------------*/
/*	DESCRIPTION : Calculate the temperature based on a voltage on PT100				*/
/*							----------------										*/
/*	INPUT : 	x																	*/
/*				X1																	*/
/*				X2																	*/
/*				Y1																	*/
/*				Y2																	*/
/*							----------------										*/
/*	OUTPUT:	  	none																*/
/************************************************************************************/
float calcul_interpolation(float x, float X1, float X2, float Y1, float Y2)
{

  return ((( x - X1)*(Y2-Y1)/(X2-X1))+Y1);

}
